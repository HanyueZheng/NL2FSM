Based on the values of the error counters, the <phrase>C<phrase>A</phrase>N</phrase> controller is<phrase> set</phrase> into the states:<phrase> error-active, error-passive or bus-off</phrase>.
The MCP2515 contains two error counters:<phrase> the Receive Error Counter (REC) (see Register 6-2) and the Transmit Error Counter (<phrase>TEC</phrase>) (see Register 6-1)</phrase>. The values of both counters can be read by<phrase> the <phrase>MCU</phrase></phrase>. These counters are incremented/decremented in accordance with the <phrase>C<phrase>A</phrase>N</phrase> bus specification.<phrase> The MCP2515 is error-active </phrase>if <phrase>both error counters are below the error-passive limit of 128</phrase>.<phrase> It is error-passive </phrase>if <phrase>at least one of the error counters equals or exceeds 128</phrase>.
<phrase>It goes to bus-off </phrase>if <phrase>the <phrase>TEC</phrase> exceeds the bus-off limit of 255</phrase>. The device remains in this state until the bus-off recovery sequence is received. The bus-off recovery sequence consists of 128 occurrences of 11 consecutive recessive bits (see Figure 6-1).
<phrase>The MCP2515, </phrase>after going bus-off, will recover back to error-active without any intervention by<phrase> the <phrase>MCU</phrase></phrase> if <phrase>the bus remains idle for 128 x 11 bit times</phrase>. If <phrase>this is not desired, the error Interrupt Service Routine (ISR) should address this</phrase>.

If <phrase>transmission is initiated via the <phrase>SPI</phrase> interface, the <phrase><phrase>TX</phrase>REQ</phrase> bit can be<phrase> set</phrase> at the same time as the <phrase>TX</phrase>Px priority bits</phrase>. When <phrase><phrase>TX</phrase>REQ</phrase> is<phrase> set</phrase>, the <phrase>A</phrase>BTF, <phrase>MLO<phrase>A</phrase></phrase> and <phrase><phrase>TX</phrase>ERR</phrase> bits (<phrase>TX</phrase>BnCTRL[5:<phrase>4]) will be<phrase> cleared automatically</phrase></phrase>.Setting the <phrase><phrase>TX</phrase>REQ</phrase> bit (<phrase>TX</phrase>BnCTRL[3]) does not initiate a message transmission. It merely flags a message buffer as being ready for transmission.<phrase> Transmission will start </phrase>when <phrase>the device detects that the bus is available</phrase>.
Once the transmission has completed successfully, the <phrase><phrase>TX</phrase>REQ</phrase> bit will be cleared, the <phrase>TX</phrase>nIF bit (<phrase>C<phrase>A</phrase>N</phrase><phrase>INT</phrase>F) will be<phrase> set</phrase> and an interrupt will be generated if the <phrase>TX</phrase>nIE bit (<phrase>C<phrase>A</phrase>N</phrase><phrase>INT</phrase>E) is<phrase> set</phrase>.
If the message transmission fails, the <phrase><phrase>TX</phrase>REQ</phrase> bit will remain<phrase> set</phrase>.<phrase><phrase> This indicates that the message is still pending for transmission and one of the following condition flags </phrase>will be<phrase> set</phrase>:
<phrase>• </phrase></phrase>If the message started to transmit but encountered an error condition, the <phrase><phrase>TX</phrase>ERR</phrase> (<phrase>TX</phrase>BnCTRL[4]) and <phrase>MERRF</phrase> bits (<phrase>C<phrase>A</phrase>N</phrase><phrase>INT</phrase>F[7]) will be<phrase> set</phrase>, and an interrupt will be generated on the <phrase>INT</phrase> pin if the <phrase>MERRE</phrase> bit (<phrase>C<phrase>A</phrase>N</phrase><phrase>INT</phrase>E[7]) is<phrase> set</phrase>.
<phrase>• </phrase>If the message is lost, arbitration at the <phrase>MLO<phrase>A</phrase></phrase> bit (<phrase>TX</phrase>BnCTRL[5]) will be<phrase> set</phrase>.

The MCP2542FD/4FD and MCP2542WFD/4WFD enter <phrase>Unpowered mode</phrase> under the following conditions:
<phrase>•<phrase>A</phrase>fter powering up the device, or
•If <phrase><phrase>VDD</phrase> drops below VP<phrase>OR</phrase>L, or
•If <phrase>V<phrase>IO</phrase></phrase> drops below VP<phrase>OR</phrase>L_<phrase>V<phrase>IO</phrase></phrase></phrase></phrase>.
The MCP2542FD/4FD and MCP2542WFD/4WFD transitions from <phrase>Unpowered mode</phrase> to <phrase>Wake mode</phrase> when <phrase>VDD</phrase> and <phrase>V<phrase>IO</phrase></phrase> are above their <phrase>P<phrase>OR</phrase>H</phrase> levels.<phrase> From Normal mode, the device will also enter <phrase>Wake mode</phrase> </phrase>if <phrase>VDD</phrase> is smaller than VUVL, or if the band gap output voltage is not within valid range. <phrase>A</phrase>dditionally, the device will transition from <phrase>Standby mode</phrase> to <phrase>Wake mode</phrase> if <phrase><phrase>STBY</phrase> is pulled Low</phrase>.
In <phrase>Wake mode</phrase>, the <phrase>C<phrase>A</phrase>N</phrase> bus is biased to ground and <phrase><phrase>RX</phrase>D</phrase> is always high.
When <phrase>VDD</phrase> exceeds VUVH, the band gap is within valid range and <phrase><phrase>TX</phrase>D</phrase> is High, the device transitions into Normal mode.
The device may be placed in <phrase>Standby mode</phrase> by applying a high level to the <phrase>STBY</phrase> pin. In <phrase>Standby mode</phrase>, the transmitter and the high-speed part of the receiver are switched off to minimize power consumption.
<phrase>The MCP2542WFD/4WFD wakes up from <phrase>Standby/Silent mode</phrase> </phrase>when a dedicated wake-up pattern (WUP) is detected on the <phrase>C<phrase>A</phrase>N</phrase> bus. The wake-up pattern is specified in <phrase>ISO</phrase> 11898-6 and <phrase>ISO</phrase>11898-2:2016

Conditions for entering the Power On Reset:
<phrase>• </phrase><phrase>VB<phrase>A</phrase>T</phrase> is below the <phrase>VB<phrase>A</phrase>T</phrase>_POD <phrase><phrase>A</phrase>ND</phrase> <phrase>VCC</phrase> is below <phrase>VCC</phrase>_UV threshold.
Conditions for leaving the Power On Reset:
<phrase>• </phrase>Once the power supply voltage <phrase>VB<phrase>A</phrase>T</phrase> <phrase>OR</phrase> <phrase>VCC</phrase> is within the functional range the transceiver enters Stand-by Mode within tPON.
<phrase>The internal Power On Reset flag </phrase>will be<phrase> set</phrase>. <phrase>A</phrase>fter <phrase>Power On Reset the TLE9252V enters Stand-by Mode</phrase>.

The global configurations are automatically loaded when <phrase>the CP2114 powers up</phrase>. The audio boot configuration depends on the Config Select pin<phrase> set</phrase>tings according to flow chart shown in the figure below. The audio configuration can be<phrase> set</phrase> by<phrase> a one-time programmable <phrase>ROM</phrase> boot index or by reading the boot index from the Config Select pins</phrase>. Setting the Config Select pins to 0x0F will load the default configuration. The one-time programmable <phrase>ROM</phrase> can be programmed in-system or Silicon Labs can provide custom preprogrammed parts with multiple customer-specified configurations.

If the EEP<phrase>ROM</phrase> operation is the “write location” (<phrase>WRITE</phrase>) or “write all” (<phrase>WR<phrase>A</phrase>L</phrase>) commands, the Host must first write the desired data into the E2P_D<phrase>A</phrase>T<phrase>A</phrase> register. The Host must then issue the <phrase>WRITE</phrase> or <phrase>WR<phrase>A</phrase>L</phrase> command using the E2P_CMD register by<phrase> set</phrase>ting the EPC_CMD field appropriately. If the operation is a <phrase>WRITE</phrase>, the EPC_<phrase>A</phrase>DDR field in E2P_CMD must also be<phrase> set</phrase> to the desired location.<phrase> The command is executed </phrase>when the Host<phrase> set</phrase>s the EPC_BSY bit high.<phrase> The completion of the operation is indicated </phrase>when <phrase>the EPC_BSY bit is cleared</phrase>.

If the EEP<phrase>ROM</phrase> operation is the “read location” (<phrase>RE<phrase>A</phrase>D</phrase>) operation, the Host must issue the <phrase>RE<phrase>A</phrase>D</phrase> command using the E2P_CMD register with the EPC_<phrase>A</phrase>DDR<phrase> set</phrase> to the desired location.<phrase> The command is executed </phrase>when the Host<phrase> set</phrase>s the EPC_BSY bit high.<phrase> The completion of the operation is indicated </phrase>when <phrase>the EPC_BSY bit is cleared</phrase>, at which time the data from the EEP<phrase>ROM</phrase> may be read from the E2P_D<phrase>A</phrase>T<phrase>A</phrase> register.

The device may initially enter the <phrase>UNPOWERED</phrase> state when a P<phrase>OR</phrase> occurs and <phrase>USB</phrase> power is not detected. This state persists until the <phrase>VBUS</phrase>_DET is asserted. The <phrase>UNPOWERED</phrase> state is alternatively entered whenever <phrase>VBUS</phrase>_DET deasserts.
The N<phrase>OR</phrase>M<phrase>A</phrase>L state is the fully functional state of the device. The are two flavors of the N<phrase>OR</phrase>M<phrase>A</phrase>L state, N<phrase>OR</phrase>M<phrase>A</phrase>L Configured and N<phrase>OR</phrase>M<phrase>A</phrase>L Unconfigured. In the Configured variation, all chip subsystem modules are enabled. The Unconfigured variation has only a subset of the modules enabled. The reduced functionality allows for power savings.
This N<phrase>OR</phrase>M<phrase>A</phrase>L state is entered by any of the following methods:
<phrase>• </phrase><phrase>A</phrase> system reset and <phrase>VBUS</phrase>_DET is asserted.
<phrase>• </phrase>The device is in the <phrase>UNPOWERED</phrase> state and <phrase>VBUS</phrase>_DET is asserted.
<phrase>• </phrase>The device is suspended and the Host issues resume signaling.
<phrase>• </phrase>The device is suspended and a wake event is detected
Upon initially entering the N<phrase>OR</phrase>M<phrase>A</phrase>L state, the device is unconfigured. The device transitions to the N<phrase>OR</phrase>M<phrase>A</phrase>L Configured state upon the Host completion of the <phrase>USB</phrase> configuration.<phrase> It is possible for the device to be deconfigured by the Host </phrase>after being placed in the N<phrase>OR</phrase>M<phrase>A</phrase>L configured state, via a<phrase> set</phrase>_configuration command. In this case, the <phrase>CPM</phrase> must place the device back into the N<phrase>OR</phrase>M<phrase>A</phrase>L Unconfigured state.
This state is entered from the N<phrase>OR</phrase>M<phrase>A</phrase>L state when the device is suspended and the <phrase>SUSPEND</phrase>_<phrase>MODE</phrase> field in the Power Management Control Register (PMT_CTL) is<phrase> set</phrase> to 00b.In this state, the M<phrase>A</phrase>C can optionally be programmed to detect a Wake-On-Lan event or Magic Packet event. <phrase>GP<phrase>IO</phrase></phrase> events can be programmed to cause wakeup in this state.
This state is entered from the N<phrase>OR</phrase>M<phrase>A</phrase>L state when the device is suspended and the <phrase>SUSPEND</phrase>_<phrase>MODE</phrase> field in the Power Management Control Register (PMT_CTL) is<phrase> set</phrase> to 01b. In this state, the Ethernet <phrase>PHY</phrase> can be optionally programmed for energy detect. <phrase>GP<phrase>IO</phrase></phrase> events can also be programmed to cause wakeup in this state.
This state is entered from the N<phrase>OR</phrase>M<phrase>A</phrase>L state when the device is suspended and the <phrase>SUSPEND</phrase>_<phrase>MODE</phrase> field in the Power Management Control Register (PMT_CTL) is<phrase> set</phrase> to 10b. <phrase>SUSPEND</phrase>2 is the default suspend mode. This state consumes the least amount of power. In this state, the device may only be awakened by the Host or <phrase>GP<phrase>IO</phrase></phrase> assertion.
This state is entered from the N<phrase>OR</phrase>M<phrase>A</phrase>L state when the device is suspended and the <phrase>SUSPEND</phrase>_<phrase>MODE</phrase> field in the Power Management Control Register (PMT_CTL) is<phrase> set</phrase> to 11b. In this suspend state, all clocks in the device are enabled and power consumption is similar to the N<phrase>OR</phrase>M<phrase>A</phrase>L state. If <phrase>GP<phrase>IO</phrase></phrase>7 is found to have caused the wakeup, the <phrase>PHY</phrase> Link Up Enable (<phrase>PHY</phrase>_LINKUP_EN) bit of the General Purpose <phrase>IO</phrase> Wake Enable and Polarity Register (<phrase>GP<phrase>IO</phrase></phrase>_W<phrase>A</phrase>KE) may be examined to determined whether a <phrase>PHY</phrase> Link Up event or pin event occurred.

a carrier indicator is<phrase> set</phrase> when the <phrase>TX</phrase> <phrase>LPI</phrase> request to the <phrase>PHY</phrase> is asserted.<phrase> The wake timer (tw_timer) is triggered </phrase>when the <phrase>TX</phrase> <phrase>LPI</phrase> request to the <phrase>PHY</phrase> is de-asserted and once <phrase>the wake timer is satisfied, the carrier indicator is cleared</phrase>. Note that there are separate <phrase>TX</phrase> wait values depending on the speed of operation.

The <phrase>UNPOWERED</phrase> state provides a mechanism for the device to conserve power when <phrase><phrase>VBUS</phrase>_DET is not connected and the device is self powered</phrase>.
The device initially enters the <phrase>UNPOWERED</phrase> state when a system reset occurs and <phrase>USB</phrase> power is not detected. This state persists until the <phrase>VBUS</phrase>_DET is asserted. The <phrase>UNPOWERED</phrase> state is alternatively entered whenever <phrase>VBUS</phrase>_DET de-asserts.
In the <phrase>UNPOWERED</phrase> state, the crystal oscillator and PLLs are turned off and the Ethernet <phrase>PHY</phrase> is disabled. <phrase>A</phrase>ssertion of <phrase>VBUS</phrase>_DET causes the device to enable the crystal oscillator and PLLs. When PLLs are stable, the device transitions to the N<phrase>OR</phrase>M<phrase>A</phrase>L-Unconfigured state.
The N<phrase>OR</phrase>M<phrase>A</phrase>L state is the functional state of the device. The are two versions of this state: N<phrase>OR</phrase>M<phrase>A</phrase>L-Configured and N<phrase>OR</phrase>M<phrase>A</phrase>L-Unconfigured. The N<phrase>OR</phrase>M<phrase>A</phrase>L state is entered by any of the following methods:
<phrase>• </phrase><phrase>A</phrase> system reset and <phrase>VBUS</phrase>_DET is asserted
<phrase>• </phrase>The device is in the <phrase>UNPOWERED</phrase> state and <phrase>VBUS</phrase>_DET is asserted
<phrase>• </phrase>The device is in a <phrase>SUSPEND</phrase>x state and the host issues resume signaling.
<phrase>• </phrase>The device is in a <phrase>SUSPEND</phrase>x state and a wake event is detected.
Upon initially entering the N<phrase>OR</phrase>M<phrase>A</phrase>L-Unconfigured state, the device is not configured. While unconfigured, the device will only draw up to 100 m<phrase>A</phrase> per the <phrase>USB</phrase> 2.0 Specification. <phrase>A</phrase>fter being configured, an additional 400 m<phrase>A</phrase> may be consumed when operating in <phrase>USB</phrase> 2.0 mode.
In order to maximize power savings in N<phrase>OR</phrase>M<phrase>A</phrase>L-Unconfigured mode, the Gigabit Ethernet <phrase>PHY</phrase> is held in reset.
<phrase>The device moves from the Normal-Unconfigured to Normal-Configured </phrase>when <phrase>directed by<phrase> the host via the SetConfiguration request</phrase></phrase>. Likewise, the host can move the device back into the Normal-Unconfigured state with this request.
This is the fully operational state of the device where all clocking resources and analog blocks are enabled and functional.
<phrase>This state is selected </phrase>when the Suspend Mode (<phrase>SUSPEND</phrase>_<phrase>MODE</phrase>) field of the Power Management Control Register (PMT_CTL) is<phrase> set</phrase> to 00b.
In this state the device can optionally be programmed to detect <phrase>GP<phrase>IO</phrase></phrase> wake, Wake-On-L<phrase>A</phrase>N event, Magic Packet, <phrase>PHY</phrase> Link Status, <phrase>EEE</phrase> wake, etc.. Refer to Section 13.4.2, "Enabling Wake Events," on page 131 for details on how to program events that cause resumption from the <phrase>SUSPEND</phrase>0 state. To maximize power savings the PLLs are shutdown. The 25 MHz crystal oscillator remains operational to clock the M<phrase>A</phrase>C and the Gigabit Ethernet <phrase>PHY</phrase>.
The detection of a <phrase>WOL</phrase> event causes the PLL, as required for the established <phrase>USB</phrase> link, to be turned on and all output clocks to be enabled.<phrase> This state is logically equivalent to <phrase>SUSPEND</phrase>0 and is selected </phrase>when the Suspend Mode (<phrase>SUSPEND</phrase>_<phrase>MODE</phrase>) field of the Power Management Control Register (PMT_CTL) is<phrase> set</phrase> to 00b.<phrase> This state is selected </phrase>when the Suspend Mode (<phrase>SUSPEND</phrase>_<phrase>MODE</phrase>) field of the Power Management Control Register
(PMT_CTL) is<phrase> set</phrase> to 10b. <phrase>SUSPEND</phrase>2 is the default suspend mode. <phrase>SUSPEND</phrase>2 consumes the least power of the suspend state options. It is the only option that meets the <phrase>USB</phrase> 2.5 m<phrase>A</phrase>
suspend power consumption requirement. In this state, <phrase>GP<phrase>IO</phrase></phrase> assertion is the only remote wakeup source supported.<phrase> This state is selected </phrase>when the Suspend Mode (<phrase>SUSPEND</phrase>_<phrase>MODE</phrase>) field of the Power Management Control Register (PMT_CTL) is<phrase> set</phrase>. Refer to Section 13.4.2.1, "Enabling <phrase>GP<phrase>IO</phrase></phrase> Wake Events," on page 131, Section 13.4.2.4, "Enabling “GOOD Frame”
Wake Events," on page 132, Section 13.4.2.2, "Enabling <phrase>WOL</phrase> Wake Events," on page 131, and Section 13.4.2.5,
"Enabling “<phrase>A</phrase>O<phrase>A</phrase>C” Wake events" for detailed instructions on how to program events that cause resumption from the <phrase>SUSPEND</phrase>3 state.<phrase> <phrase>SUSPEND</phrase>3 can also be exited </phrase>when Energy Efficient Ethernet <phrase>RX</phrase> Wake (<phrase>EEE</phrase>_<phrase>RX</phrase>_W<phrase>A</phrase>KE) is<phrase> set</phrase> with Energy Efficient Ethernet <phrase>RX</phrase> Wake Enable (<phrase>EEE</phrase>_<phrase>RX</phrase>_W<phrase>A</phrase>KE_EN)<phrase> set</phrase> or when Energy Efficient Ethernet <phrase>TX</phrase> Wake (<phrase>EEE</phrase>_<phrase>TX</phrase>_W<phrase>A</phrase>KE) is<phrase> set</phrase> with Energy Efficient Ethernet <phrase>TX</phrase> Wake Enable (<phrase>EEE</phrase>_<phrase>TX</phrase>_W<phrase>A</phrase>KE_EN)<phrase> set</phrase>.

The following power states are featured:
<phrase>• </phrase>N<phrase>OR</phrase>M<phrase>A</phrase>L (Unconfigured and Configured)
<phrase>• </phrase>Suspend (<phrase>SUSPEND</phrase>0, <phrase>SUSPEND</phrase>1, <phrase>SUSPEND</phrase>2, and <phrase>SUSPEND</phrase>3)
The are two flavors of the N<phrase>OR</phrase>M<phrase>A</phrase>L state, N<phrase>OR</phrase>M<phrase>A</phrase>L Configured and N<phrase>OR</phrase>M<phrase>A</phrase>L Unconfigured.
This N<phrase>OR</phrase>M<phrase>A</phrase>L state is entered by any of the following methods:
<phrase>• </phrase><phrase>A</phrase> system reset is asserted.
<phrase>• </phrase>The device is suspended and the host issues resume signaling.
<phrase>• </phrase>The device is suspended and a wake event is detected.
Upon initially entering the N<phrase>OR</phrase>M<phrase>A</phrase>L state, the device is unconfigured. The device transitions to the N<phrase>OR</phrase>M<phrase>A</phrase>L Configured state upon the host completion of the <phrase>USB</phrase> configuration.
<phrase>It is possible for the device to be deconfigured by the host </phrase>after being placed in the N<phrase>OR</phrase>M<phrase>A</phrase>L Configured state, via a<phrase> set</phrase>_configuration command. In this case, the <phrase>CPM</phrase> must place the device back into the N<phrase>OR</phrase>M<phrase>A</phrase>L Unconfigured state.
<phrase>A</phrase>fter a system reset, the device is placed into the N<phrase>OR</phrase>M<phrase>A</phrase>L Unconfigured state. When in the N<phrase>OR</phrase>M<phrase>A</phrase>L state, the <phrase>RE<phrase>A</phrase>D</phrase>Y bit in the Power Management Control Register (PMT_CTL) is<phrase> set</phrase>.
When returning to the N<phrase>OR</phrase>M<phrase>A</phrase>L state from the <phrase>SUSPEND</phrase> state, the <phrase>USB</phrase> context is maintained. <phrase>A</phrase>fter entering the N<phrase>OR</phrase>M<phrase>A</phrase>L state, the <phrase>RE<phrase>A</phrase>D</phrase>Y bit in the PMT_CTL register is asserted. If the originating <phrase>SUSPEND</phrase> state is <phrase>SUSPEND</phrase>2, the host is required to reinitialize the Ethernet <phrase>PHY</phrase> registers.
<phrase>A</phrase>ll suspend states must respond to a <phrase>USB</phrase> Reset and pin reset, nRESET. The application of these resets result in the device’s hardware being re-initialized and placed into the N<phrase>OR</phrase>M<phrase>A</phrase>L Unconfigured state.
This state is entered from the N<phrase>OR</phrase>M<phrase>A</phrase>L state when the device is suspended and the <phrase>SUSPEND</phrase>_<phrase>MODE</phrase> field in the Power Management Control Register (PMT_CTL) is<phrase> set</phrase> to 00b.
Refer to Section 4.12.2.1, "Enabling <phrase>GP<phrase>IO</phrase></phrase> Wake Events", Section 4.12.2.2, "Enabling <phrase>WOL</phrase> Wake Events" and Section 4.12.2.4, "Enabling External <phrase>PHY</phrase> Link Up Wake Events" for detailed instructions on how to program events that cause resumption from the <phrase>SUSPEND</phrase>0 state. In this state, the M<phrase>A</phrase>C can optionally be programmed to detect a Wake On L<phrase>A</phrase>N event or Magic Packet event.
<phrase>GP<phrase>IO</phrase></phrase> events can be programmed to cause wakeup in this state. If <phrase>GP<phrase>IO</phrase></phrase>7 signals the event, the <phrase>PHY</phrase> Link Up Enable (<phrase>PHY</phrase>_LINKUP_EN) bit of the General Purpose <phrase>IO</phrase> Wake Enable and Polarity Register (<phrase>GP<phrase>IO</phrase></phrase>_W<phrase>A</phrase>KE) may be examined to determined whether a <phrase>PHY</phrase> Link Up event or Pin event occurred.
This state is entered from the N<phrase>OR</phrase>M<phrase>A</phrase>L state when the device is suspended and the <phrase>SUSPEND</phrase>_<phrase>MODE</phrase> field in the Power Management Control Register (PMT_CTL) is<phrase> set</phrase> to 01b.
Refer to Section 4.12.2.1, "Enabling <phrase>GP<phrase>IO</phrase></phrase> Wake Events", and Section 4.12.2.3, "Enabling Link Status Change (Energy Detect) Wake Events" for detailed instructions on how to program events that cause resumption from the <phrase>SUSPEND</phrase>1 state.
In this state, the Ethernet <phrase>PHY</phrase> can be optionally programmed for energy detect. <phrase>GP<phrase>IO</phrase></phrase> events can also be programmed to cause wakeup in this state.
This state is entered from the N<phrase>OR</phrase>M<phrase>A</phrase>L state when the device is suspended and the <phrase>SUSPEND</phrase>_<phrase>MODE</phrase> field in the Power Management Control Register (PMT_CTL) is<phrase> set</phrase> to 10b. <phrase>SUSPEND</phrase>2 is the default suspend mode.
Refer to Section 4.12.2.1, "Enabling <phrase>GP<phrase>IO</phrase></phrase> Wake Events" for detailed instructions on how to program events that cause resumption from the <phrase>SUSPEND</phrase>2 state.
This state consumes the least amount of power. In this state, the device may only be awakened by the host or <phrase>GP<phrase>IO</phrase></phrase> assertion.
The state of the Ethernet <phrase>PHY</phrase> is lost when entering <phrase>SUSPEND</phrase>2. Therefore, host must reinitialize the <phrase>PHY</phrase> after the device returns to the N<phrase>OR</phrase>M<phrase>A</phrase>L state.
This state is entered from the N<phrase>OR</phrase>M<phrase>A</phrase>L state when the device is suspended and the <phrase>SUSPEND</phrase>_<phrase>MODE</phrase> field in the Power Management Control Register (PMT_CTL) is<phrase> set</phrase> to 11b.
Refer to Section 4.12.2.1, "Enabling <phrase>GP<phrase>IO</phrase></phrase> Wake Events", Section 4.12.2.4, "Enabling External <phrase>PHY</phrase> Link Up Wake Events" and Section 4.12.2.5, "Enabling Good Frame Wake Events" for detailed instructions on how to program events that cause resumption from the <phrase>SUSPEND</phrase>3 state.
This state supports wakeup from <phrase>GP<phrase>IO</phrase></phrase> assertion, <phrase>PHY</phrase> Link Up, and on reception of a frame passing the filtering constraints<phrase> set</phrase> by the M<phrase>A</phrase>C Control Register (M<phrase>A</phrase>C_CR). Due to the limited amount of <phrase>RX</phrase> <phrase>FIFO</phrase> buffering, it is possible that there will be frames lost when in this state, as the <phrase>USB</phrase> resume time greatly exceeds the buffering capacity of the <phrase>FIFO</phrase>.

Once <phrase>the hardware is initialized, the firmware can begin to execute</phrase> from the internal <phrase>ROM</phrase>. The firmware checks the CFG_SEL[1:<phrase>0] configuration strap values to determine if <phrase>it is configured for I2C Master loading</phrase></phrase>. If so, the configuration is loaded from an external I2C <phrase>ROM</phrase> in the device’s <phrase>CONFIG</phrase> state.
For all other configurations, the firmware checks for the presence of an external I2C/SMBus. It does this by<phrase> asserting two pull down resistors on the data and clock lines of the bus</phrase>. The pull downs are typically 50Kohm. If <phrase>there are 10Kohm pull-ups present, the device becomes aware of the presence of an external SMBus/I2C bus</phrase>. If <phrase>a bus is detected, the firmware transitions to the <phrase>SOC</phrase>_CFG state</phrase>.
In <phrase>SOC</phrase>_CFG, the <phrase>SOC</phrase> may modify any of the default configuration<phrase> set</phrase>tings specified in the integrated <phrase>ROM</phrase> such as <phrase>USB</phrase> device descriptors, or port electrical<phrase> set</phrase>tings, and control features such as upstream battery charging detection. There is no time limit. In this stage the firmware will wait indefinitely for the SMBus/I2C configuration. When the <phrase>SOC</phrase> has completed configuring the device, it must write to register 0xFF to end the configuration.
Once the <phrase>SOC</phrase> has indicated that it is done with configuration, then all the configuration data is combined. The default data, the <phrase>SOC</phrase> configuration data, the <phrase>OTP</phrase> data are all combined in the firmware and device is programmed. <phrase>A</phrase>fter the device is fully configured, it will go idle and then into suspend if <phrase>there is no <phrase>VBUS</phrase> or Hub</phrase>.Connect present. Once <phrase>VBUS</phrase> is present, and upstream battery charging is enabled, the device will transition to the Battery Charger Detection Stage (<phrase>CHGDET</phrase>). If <phrase>VBUS</phrase> is present, and upstream battery charging is not enabled, the device will transitions to the Connect (Hub.Connect) stage.

Once <phrase>the hardware is initialized, the firmware can begin to execute</phrase>. The internal firmware checks for an external <phrase>SPI</phrase> <phrase>ROM</phrase>. The firmware looks for an external <phrase>SPI</phrase> flash device that contains a valid signature of “2DFU” (device firmware upgrade) beginning at address 0xFFF<phrase>A</phrase>. If a valid signature is found, then the external <phrase>ROM</phrase> is enabled and the code execution begins at address 0x0000 in the external <phrase>SPI</phrase> device. If a valid signature is not found, then execution continues from internal <phrase>ROM</phrase>. <phrase>SPI</phrase> <phrase>ROM</phrase>s used with the device must be<phrase> 1 Mbit and support either 30 MHz or 60 MHz</phrase>. If <phrase>there are 10Kohm pull-ups present, the device becomes aware of the presence of an external SMBus/I2C bus</phrase>. If <phrase>a bus is detected, the firmware transitions to the <phrase>SOC</phrase>_CFG state</phrase>.
In this stage, the <phrase>SOC</phrase> may modify any of the default configuration<phrase> set</phrase>tings specified in the integrated <phrase>ROM</phrase> such as <phrase>USB</phrase> device descriptors, or port electrical<phrase> set</phrase>tings, and control features such as upstream battery charging detection.
There is no time limit. In this stage the firmware will wait indefinitely for the SMBus/I2C configuration. When the <phrase>SOC</phrase> has completed configuring the device, it must write to register 0xFF to end the configuration.
Once the <phrase>SOC</phrase> has indicated that it is done with configuration, then all the configuration data is combined. The default data, the <phrase>SOC</phrase> configuration data, the <phrase>OTP</phrase> data are all combined in the firmware and device is programmed.
<phrase>A</phrase>fter the device is fully configured, it will go idle and then into suspend if <phrase>there is no <phrase>VBUS</phrase> or Hub</phrase>.Connect present. Once <phrase>VBUS</phrase> is present, and upstream battery charging is enabled, the device will transition to the Battery Charger Detection Stage (<phrase>CHGDET</phrase>). If <phrase>VBUS</phrase> is present, and upstream battery charging is not enabled, the device will transitions to the Connect (Hub.Connect) stage.
<phrase>A</phrase>fter configuration, if <phrase>enabled, the device enters the Battery Charger Detection Stage</phrase>. If the battery charger detection feature was disabled during the <phrase>CONFIG</phrase> stage, the device will immediately transition to the Hub Connect (Hub.Connect) stage. If <phrase>the battery charger detection feature remains enabled, the battery charger detection sequence is started
automatically</phrase>.
If <phrase>the charger detection remains enabled, the device will transition to the Hub</phrase>.<phrase>Connect stage </phrase>if <phrase>using the hardware detection mechanism</phrase>.
Once <phrase>the <phrase>CHGDET</phrase> stage is completed, the device enters the Hub</phrase>.Connect stage.

The first stage, the initialization stage, occurs on the deassertion of RESET_N. If a valid signature is found, then the <phrase>SPI</phrase> Firmware/external <phrase>SPI</phrase> <phrase>ROM</phrase> is enabled and the code execution begins at address 0x0000 in the external <phrase>SPI</phrase> device. If a valid signature is not found, then execution continues from internal <phrase>ROM</phrase> (CFG_<phrase>ROM</phrase> stage). If the system is not strapped for <phrase>SPI</phrase> Mode, code execution will continue from internal <phrase>ROM</phrase> (CFG_<phrase>ROM</phrase> stage).
5.1.3<phrase>CONFIG</phrase>UR<phrase>A</phrase>T<phrase>IO</phrase>N F<phrase>ROM</phrase> <phrase>INT</phrase>ERN<phrase>A</phrase>L <phrase>ROM</phrase> ST<phrase>A</phrase>GE (CFG_<phrase>ROM</phrase>)
In this stage, the internal firmware loads the default values from the internal <phrase>ROM</phrase>. Most of the hub configuration registers, <phrase>USB</phrase> descriptors, electrical<phrase> set</phrase>tings, etc.<phrase> will be initialized in this state even </phrase>when running from <phrase>SPI</phrase>.
If the <phrase>CONFIG</phrase>_STR<phrase>A</phrase>P_[2:1] pins are<phrase> set</phrase> to Configuration 5, the device will move to the SMBUS_<phrase>CHECK</phrase> stage, otherwise it move to the CFG_<phrase>OTP</phrase> stage.
5.1.5SMBUS <phrase>CHECK</phrase> ST<phrase>A</phrase>GE (SMBUS_<phrase>CHECK</phrase>)
Based on the PROG_FUNC[8:<phrase>1] configuration selected (refer to Section 3</phrase>.3.4, "PROG_FUNC[8:1] Configuration (<phrase>CONFIG</phrase>_STR<phrase>A</phrase>P_[2:1])"), the firmware will check for the presence of external pull up resistors on the SMBus slave programmable function pins.<phrase> If 10K pull-ups are detected on both pins, the device </phrase>will be configured as an SMBus slave, and the next state will be CFG_<phrase>SOC</phrase>. If a pull-up is not detected in either of the pins, the next state is CFG_<phrase>OTP</phrase>.
5.1.6<phrase>SOC</phrase> <phrase>CONFIG</phrase>UR<phrase>A</phrase>T<phrase>IO</phrase>N ST<phrase>A</phrase>GE (CFG_<phrase>SOC</phrase>)
In this stage, the <phrase>SOC</phrase> can modify any of the default configuration<phrase> set</phrase>tings specified in the integrated <phrase>ROM</phrase>, such as <phrase>USB</phrase> device descriptors, port electrical<phrase> set</phrase>tings, and control features such as downstream battery charging.
In this stage the firmware will wait indefinitely for the SMBus/I2C configuration there is no time limit on this stage. The external SMBus master writes to register 0xFF, to end the configuration in legacy mode. In non-legacy mode, the SMBus command <phrase>USB</phrase>_<phrase>A</phrase>TT<phrase>A</phrase>CH (opcode 0x<phrase>A</phrase><phrase>A</phrase>55) or <phrase>USB</phrase>_<phrase>A</phrase>TT<phrase>A</phrase>CH_WITH_SMBUS (opcode 0x<phrase>A</phrase><phrase>A</phrase>56) will finish the configuration.
5.1.7<phrase>OTP</phrase> <phrase>CONFIG</phrase>UR<phrase>A</phrase>T<phrase>IO</phrase>N ST<phrase>A</phrase>GE (CFG_<phrase>OTP</phrase>)
Once the <phrase>SOC</phrase> has indicated that it is done with configuration, all configuration data is combined in this stage. The default data, the <phrase>SOC</phrase> configuration data, and the <phrase>OTP</phrase> data are all combined in the firmware and the device is programmed.
5.1.8<phrase>HUB</phrase> <phrase>CONNECT</phrase> ST<phrase>A</phrase>GE (<phrase>USB</phrase>_<phrase>A</phrase>TT<phrase>A</phrase>CH)
Once the hub registers are updated through default values, SMBus master, and <phrase>OTP</phrase>, the device firmware will enable attaching the <phrase>USB</phrase> host by<phrase> set</phrase>ting the <phrase>USB</phrase>_<phrase>A</phrase>TT<phrase>A</phrase>CH bit in the <phrase>HUB</phrase>_CMD_ST<phrase>A</phrase>T register. The device will remain in the Hub <phrase>Connect stage </phrase>indefinitely until the <phrase>VBUS</phrase> function is deasserted/assertion of external RESET_N pin.
5.1.9N<phrase>OR</phrase>M<phrase>A</phrase>L <phrase>MODE</phrase> (N<phrase>OR</phrase>M<phrase>A</phrase>L_<phrase>MODE</phrase>)
Lastly, the hub enters Normal Mode of operation.

<phrase>SPI</phrase> INITI<phrase>A</phrase>LIZ<phrase>A</phrase>T<phrase>IO</phrase>N ST<phrase>A</phrase>GE (<phrase>SPI</phrase>_INIT)
The first stage, the initialization stage, occurs on the deassertion of RESET_N. The internal
firmware then checks for an external <phrase>SPI</phrase> <phrase>ROM</phrase>. If a valid signature is found, then the external <phrase>ROM</phrase> is enabled and the code execution begins at address 0x0000 in the external <phrase>SPI</phrase> device. If a valid signature is not found, then execution continues from internal <phrase>ROM</phrase> (CFG_RD stage).
<phrase>CONFIG</phrase>UR<phrase>A</phrase>T<phrase>IO</phrase>N <phrase>RE<phrase>A</phrase>D</phrase> ST<phrase>A</phrase>GE (CFG_RD)
In this stage, the internal firmware loads the default values from the internal <phrase>ROM</phrase> and then uses the configuration strapping options to override the default values. Refer to Section 3.4, "Configuration Straps and Programmable Functions" for information on usage of the various device configuration straps.
STR<phrase>A</phrase>P <phrase>RE<phrase>A</phrase>D</phrase> ST<phrase>A</phrase>GE (STR<phrase>A</phrase>P)
In this stage, the firmware registers the configuration strap<phrase> set</phrase>tings on the <phrase>SPI</phrase>_DO and <phrase>SPI</phrase>_CLK pins. Refer to Section 3.4.1, "<phrase>SPI</phrase>/SMBus Configuration" for information on configuring these straps.<phrase> If configured for SMBus Slave Mode, the next state </phrase>will be <phrase>SOC</phrase>_CFG. Otherwise, the next state is <phrase>OTP</phrase>_CFG.
<phrase>SOC</phrase> <phrase>CONFIG</phrase>UR<phrase>A</phrase>T<phrase>IO</phrase>N ST<phrase>A</phrase>GE (<phrase>SOC</phrase>_CFG)
In this stage, the <phrase>SOC</phrase> can modify any of the default configuration<phrase> set</phrase>tings specified in the integrated <phrase>ROM</phrase>, such as <phrase>USB</phrase> device descriptors and port electrical<phrase> set</phrase>tings.
There is no time limit on this mode. In this stage the firmware will wait indefinitely for the SMBus/I2C configuration. When the <phrase>SOC</phrase> has completed configuring the device, it must write to register 0xFF to end the configuration.
<phrase>OTP</phrase> <phrase>CONFIG</phrase>UR<phrase>A</phrase>T<phrase>IO</phrase>N ST<phrase>A</phrase>GE (<phrase>OTP</phrase>_CFG)
Once the <phrase>SOC</phrase> has indicated that it is done with configuration, all configuration data is combined in this stage. The default data, the <phrase>SOC</phrase> configuration data, and the <phrase>OTP</phrase> data are all combined in the firmware and the device is programmed. <phrase>A</phrase>fter the device is fully configured, it will go idle and then into suspend if <phrase>there is no <phrase>VBUS</phrase> or Hub</phrase>.Connect present.
Once <phrase>VBUS</phrase> is present, and battery charging is enabled, the device will transition to the Battery Charger Detection Stage. If <phrase>VBUS</phrase> is present, and battery charging is not enabled, the device will transition to the Connect stage.
<phrase>HUB</phrase> <phrase>CONNECT</phrase> ST<phrase>A</phrase>GE (<phrase>HUB</phrase>.<phrase>CONNECT</phrase>)
Once <phrase>the <phrase>CHGDET</phrase> stage is completed, the device enters the Hub</phrase> Connect stage.

<phrase>SPI</phrase> Initialization Stage (<phrase>SPI</phrase>_INIT)
The first stage, the initialization stage, occurs on the deassertion of RESET_N. If a valid signature is found, then the external <phrase>ROM</phrase> is enabled and the code execution begins at address 0x0000 in the external <phrase>SPI</phrase> device. If a valid signature is not found, then execution continues from internal <phrase>ROM</phrase> (CFG_RD stage).
Configuration Read Stage (CFG_RD)
In this stage, the internal firmware loads the default values from the internal <phrase>ROM</phrase> and then uses the configuration strapping options to override the default values. Refer to Section 3.5, Configuration Straps and Programmable Functions for information on usage of the various device configuration straps.
Strap Read Stage (STR<phrase>A</phrase>P)
In this stage, the firmware registers the configuration strap<phrase> set</phrase>tings and checks the state of CFG_STR<phrase>A</phrase>P. If CFG_STR<phrase>A</phrase>P is<phrase> set</phrase> for <phrase>CONFIG</phrase>2, then the hub will check the state of the SMBD<phrase>A</phrase>T<phrase>A</phrase> and <phrase>SMBCLK</phrase> pins. If 10k pull-up resistors are detected on both pins, the device will enter the <phrase>SOC</phrase>_CFG stage. If 10k pull-up resistors are not detected on both pins, the hub will transition to the <phrase>OTP</phrase>_CFG stage instead.
<phrase>SOC</phrase> Configuration Stage (<phrase>SOC</phrase>_CFG)
In this stage, the <phrase>SOC</phrase> can modify any of the default configuration<phrase> set</phrase>tings specified in the integrated <phrase>ROM</phrase>, such as <phrase>USB</phrase> device descriptors and port electrical<phrase> set</phrase>tings. There is no time limit on this mode. In this stage the firmware will wait indefinitely for the SMBus/I2C configuration. When the <phrase>SOC</phrase> has completed configuring the device, it must write to register 0xFF to end the configuration.
<phrase>OTP</phrase> Configuration Stage (<phrase>OTP</phrase>_CFG)
Once the <phrase>SOC</phrase> has indicated that it is done with configuration, all configuration data is combined in this stage. The default data, the <phrase>SOC</phrase> configuration data, and the <phrase>OTP</phrase> data are all combined in the firmware and the device is programmed. <phrase>A</phrase>fter the device is fully configured, it will go idle and then into suspend if <phrase>there is no <phrase>VBUS</phrase> or Hub</phrase>.Connect present.
Once <phrase>VBUS</phrase> is present, and battery charging is enabled, the device will transition to the Battery Charger Detection Stage. If <phrase>VBUS</phrase> is present, and battery charging is not enabled, the device will transition to the Connect stage.
Hub Connect Stage (Hub.<phrase>Connect)
</phrase>Once <phrase>the <phrase>CHGDET</phrase> stage is completed, the device enters the Hub</phrase> Connect stage. <phrase>USB</phrase> connect can be initiated by asserting the <phrase>VBUS</phrase> pin function high. The device will remain in the Hub <phrase>Connect stage </phrase>indefinitely until the <phrase>VBUS</phrase> pin function is deasserted. Lastly, the hub enters Normal Mode of operation.
